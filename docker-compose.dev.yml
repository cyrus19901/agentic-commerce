services:
  agentic-commerce-dev:
    container_name: agentic-commerce-dev
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "3000:3000"
    volumes:
      # Mount source code for hot reload
      - ./packages:/app/packages
      - ./data:/app/data
      # Preserve node_modules in container
      - /app/node_modules
      - /app/packages/api/node_modules
      - /app/packages/core/node_modules
      - /app/packages/database/node_modules
      - /app/packages/integrations/node_modules
      - /app/packages/shared/node_modules
    environment:
      - NODE_ENV=development
      - PORT=3000
      - DATABASE_PATH=/app/data/shopping.db
      - JWT_SECRET=your-secret-key-change-in-production
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY:-}
      - ETSY_API_KEY=${ETSY_API_KEY:-}
      # Solana: devnet only (set SOLANA_CLUSTER=mainnet-beta for mainnet)
      - SOLANA_CLUSTER=${SOLANA_CLUSTER:-devnet}
      - SOLANA_RPC_DEVNET=${SOLANA_RPC_DEVNET:-https://solana-devnet.g.alchemy.com/v2/ZJmVXF-LVxv651ws9azjqBr6Upv_l9_5}
      - SOLANA_RPC_MAINNET=${SOLANA_RPC_MAINNET:-https://api.mainnet-beta.solana.com}
      - USDC_MINT_DEVNET=${USDC_MINT_DEVNET:-Gh9ZwEmdLJ8DscKNTkTqPbNwLNNBjuSzaG9Vp2KGtKJr}
      - USDC_MINT_MAINNET=${USDC_MINT_MAINNET:-EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v}
      # Agent Configuration
      - AGENT_ID=${AGENT_ID:-agent://agentic-commerce/v1}
      - USDC_TOKEN_ACCOUNT=${USDC_TOKEN_ACCOUNT:-}
      - SOLANA_PUBKEY=${SOLANA_PUBKEY:-}
      # Facilitator Configuration
      - FACILITATOR_URL=${FACILITATOR_URL:-http://localhost:3000/api/facilitator}
      - FACILITATOR_SHARED_SECRET=${FACILITATOR_SHARED_SECRET:-dev-secret-change-in-production}
    command: npm run dev
    stdin_open: true
    tty: true

  # Optional: Add a frontend service
  # gordon-fe-policy:
  #   container_name: gordon-fe-policy-dev
  #   build:
  #     context: ../gordon-fe-policy
  #     dockerfile: Dockerfile
  #   ports:
  #     - "3001:3001"
  #   environment:
  #     - NEXT_PUBLIC_API_URL=http://localhost:3000
  #   depends_on:
  #     - agentic-commerce-dev
